language: generic
sudo: false
env:
  global:
    - INSTALL_EDM_VERSION=1.9.2
      PYTHONUNBUFFERED="1"
  matrix:
    - ENAML='pypi-latest'
    - ENAML='edm-latest'
    - ENAML='0.8.9'

matrix:
  allow_failures:
    - env: ENAML='pypi-latest'

addons:
  apt:
    packages:
    - swig
    - ccache
cache:
  pip: true
  directories:
    - $HOME/.ccache
    - $HOME/.cache/edm

before_install:
  - mkdir -p "${HOME}/.cache/download"
  - export PATH="/usr/lib/ccache/usr/local/bin:${PATH}"
  - export DISPLAY=:99.0
  - sh -e /etc/init.d/xvfb start
  - ccache -s
install:
  - ./install-edm-linux.sh
  - edm install -y click
  - edm run -- python -m etstools install --enaml=${ENAML}
script:
  - edm run -- python -m etstools test
after_success:
  - edm run -- pip install codecov
  - edm run -- codecov