language: generic
sudo: false
env:
  global:
    - INSTALL_EDM_VERSION=1.9.2
      PYTHONUNBUFFERED="1"


matrix:
  include:
    - name: "Minimum enaml in EDS"
      env: ENAML='0.9.8'  SOURCE='edm'  # The earliest version on EDS for rh6
    - name: "Minimum enaml supported"
      env: ENAML='0.8.9'  SOURCE='pypi' # The earliest supported
    - name: "Latest enaml in EDS"
      env: ENAML='latest' SOURCE='edm'
    - name: "Max enaml supported"
      env: ENAML='0.10.2' SOURCE='pypi'
    - name: "Latest enaml released on pypi"
      env: ENAML='latest' SOURCE='pypi'
    - if: type = cron
      name: "Cutting edge (unreleased) enaml"
      env: ENAML='latest' SOURCE='github'
  allow_failures:
    - env: ENAML='latest' SOURCE='pypi'
    - env: ENAML='latest' SOURCE='github'

addons:
  apt:
    packages:
    - swig
    - ccache
cache:
  pip: true
  directories:
    - $HOME/.ccache
    - $HOME/.cache/edm

before_install:
  - mkdir -p "${HOME}/.cache/download"
  - export PATH="/usr/lib/ccache/usr/local/bin:${HOME}/edm/bin:${PATH}"
  - export DISPLAY=:99.0
  - sh -e /etc/init.d/xvfb start
  - ccache -s
install:
  - ./install-edm-linux.sh
  - edm install -y click coverage
  - edm run -- python -m etstool install --enaml=${ENAML} --source=${SOURCE} --toolkit=pyside
  - edm run -- python -m etstool install --enaml=${ENAML} --source=${SOURCE} --toolkit=pyqt4
script:
  - edm run -- python -m etstool test --toolkit=pyside
  - edm run -- python -m etstool test --toolkit=pyqt4
after_success:
  - edm run -- coverage combine
  - edm run -- pip install codecov
  - edm run -- codecov